
<%= render 'users/error', book: @book %>

<div class="container">
  <div class="row">
    <main class= "box clearfix">
      <div class= "user-info col-sm-3">
        <%= render 'users/list', user: current_user, books: @book %>
      </div>


      <h2>Book</h2>
        <div class="col-sm-9">

          <table class="table float-lg-right">
            <thead>

                <tr>
                  <th></th>
                  <th>title</th>
                  <th>body</th>
              </tr>
            </thead>
            <tbody>
            <% @books.each do |book| %>
                <tr>
                  <td><%= attachment_image_tag book.user, :profile_image, size: "50x50", fallback: "no_image.jpg"  %></td>

                  <td><%= link_to book.title, book_path(book.id) %></td>
                  <td><%= book.body %></td>
                  <td><%= book.comments.count %> コメント数</td>
                  <td>
                  <% if user_signed_in? %>
                    <% if book.favorited_by?(current_user) %>
                    <!-- ログインしているユーザーがファボしたかどうかで分岐 -->
                      <td>
                        <%= link_to book_favorites_path(book.id), method: :delete do %>
                          <i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
                        <%= book.favorites.count %> いいね
                        <% end %>
                      </td>
                      <% else %>
                      <td>
                        <%= link_to book_favorites_path(book.id), method: :post do %>
                          <i class="fa fa-heart-o" aria-hidden="true"></i>
                        <%= book.favorites.count %> いいね
                        <% end %>
                      </td>
                    <% end %>
                  <% else %>
                    <p><span>お気に入り数: </span><%= book.favorites.count %></p>
                  <% end %>
                </td>
              </tr>
             <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </main>

  </div>
</div>



